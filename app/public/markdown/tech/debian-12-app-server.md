# Debian 12 Communications Server

[[toc]]

## Services installed

* OpenResty auto-ssl server
* Pleroma Fediverse server
* Matrix
* ejabberd XMPP/SIP

## Create Debian 12

Using AWS and a small Graviton EC2 instance with Debian 12.

## Upgrade OS

```sh
sudo apt update && sudo apt upgrade -y
```

## Install requirements

```sh
sudo apt install build-essential libssl-dev git postgresql-client postgresql-contrib cmake libmagic-dev elixir erlang-dev erlang-nox imagemagick ffmpeg libimage-exiftool-perl -y
```
## Create users

```sh
sudo useradd -r -s /bin/false -m -d /var/lib/pleroma -U pleroma
```

## Install Pleroma

Create directory owned by pleroma and checkout the code.
Then change to the new directory.

```sh
sudo mkdir -p /opt/pleroma
sudo chown -R pleroma:pleroma /opt/pleroma
sudo -Hu pleroma git clone -b stable https://git.pleroma.social/pleroma/pleroma /opt/pleroma
cd /opt/pleroma
```

```sh
sudo -Hu pleroma mix deps.get
```

```sh
sudo -Hu pleroma MIX_ENV=prod mix pleroma.instance gen
```

```sh
What domain will your instance use? (e.g pleroma.soykaf.com) []  what.izzup.com
What is the name of your instance? (e.g. The Corndog Emporium) [what.izzup.com]  Izzup
What is your admin email address? []  support@izzup.com
What email address do you want to use for sending email notifications? [support@izzup.com]  community@izzup.com
Do you want search engines to index your site? (y/n) [y]
Do you want to store the configuration in the database (allows controlling it from admin-fe)? (y/n) [n]  y
What is the hostname of your database? [localhost]  izzup.civgj44bl0ep.us-east-1.rds.amazonaws.com
What is the name of your database? [pleroma]  izzup_pleroma
What is the user used to connect to your database? [pleroma]  postgres
What is the password used to connect to your database? [autogenerated]  vm!lzPDyKVNgRB98c*UP*K06RA3z
Would you like to use RUM indices? [n]
What port will the app listen to (leave it if you are using the default setup with nginx)? [4000]
What ip will the app listen to (leave it if you are using the default setup with nginx)? [127.0.0.1]
What directory should media uploads go in (when using the local uploader)? [uploads]
What directory should custom public files be read from (custom emojis, frontend bundle overrides, robots.txt, etc.)? [instance/static/]
Do you want to strip location (GPS) data from uploaded images? This requires exiftool, it was detected as installed. (y/n) [y]
Do you want to read data from uploaded files so clients can use it to prefill fields like image description? This requires exiftool, it was detected as installed. (y/n) [y]
Do you want to anonymize the filenames of uploads? (y/n) [n]  y
Do you want to deduplicate uploaded files? (y/n) [n]  y
Writing config to config/generated_config.exs.
Writing the postgres script to config/setup_db.psql.
Backing up existing robots.txt to /opt/pleroma/instance/static/robots.txt.bak
Writing /opt/pleroma/instance/static/robots.txt.
```

```sh
sudo -Hu pleroma mv config/{generated_config.exs,prod.secret.exs
```

## Install PgBouncer

```sh
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
```

```sh
sudo   wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
```

```sh
sudo apt update
```

```sh
sudo apt install pgbouncer -y
```

## Install nvm

```sh
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/master/install.sh | bash
source ~/.bashrc
```

## Install Node v20

```sh
nvm install 20
```

## Install Redis

```sh
sudo apt install redis -y
```

```sh
sudo systemctl disable redis
```






